<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Thi·ªáp m·ª´ng sinh nh·∫≠t</title>
  <link rel="stylesheet" href="main.css">
</head>
<body>
  <div class="stage">
    <div id="card" class="card" title="·∫§n ƒë·ªÉ m·ªü thi·ªáp">
      <div class="ribbon">To Ho√†ng Nh∆∞</div>
      <div>
        <div class="title">ÏÉùÏùº Ï∂ïÌïòÌï©ÎãàÎã§!</div>
        <div class="subtitle">Ïà®ÏùÄ Ìé∏ÏßÄÎ•º Ï∞æÎã§ üéâ</div>
      </div>
    </div>

    <div class="notes-wrap" id="notesWrap"></div>

    <div class="controls">
      <button id="resetBtn" class="btn hidden">N·ªØa n√®</button>
    </div>
  </div>

  <!-- Modal ƒë·ªÉ ƒë·ªçc note -->
  <div id="modalOverlay" class="modal-overlay">
    <div class="modal-note">
      <div class="msg" id="modalMsg"></div>
      <div class="from" id="modalFrom"></div>
      <button class="close-btn" id="closeModal">ƒê√≥ng</button>
    </div>
  </div>

  <script>
    const card = document.getElementById('card')
    const notesWrap = document.getElementById('notesWrap')
    const resetBtn = document.getElementById('resetBtn')
    const modalOverlay = document.getElementById('modalOverlay')
    const modalMsg = document.getElementById('modalMsg')
    const modalFrom = document.getElementById('modalFrom')
    const closeModal = document.getElementById('closeModal')

    // Danh s√°ch tin nh·∫Øn
    const messages = [
      'Ch√∫c Ho√†ng Nh∆∞ tu·ªïi 19 th·∫≠t r·ª±c r·ª° nha',
      'T√≠nh t kh√¥ khan n√™n hong bi·∫øt ch√∫c g√¨ nhi·ªÅu h·∫øt √°',
      'M·∫∑c d√π 2 ƒë·ª©a m√¨nh r·∫•t √≠t khi nh·∫Øn tin nh∆∞ng m√† c√≥ sao ƒë√¢u',
      'U·∫ßy, m·ªõi ƒë√¢y m√† 9 nƒÉm r·ªìi nh·ªâ, t·ª´ l·ªõp 5 gi·ªù t·ªõi l·ªõp 14 lu√¥n r·ªìi',
      'Ch·ª´ng ·∫•y nƒÉm ch∆°i chung nhma t √≠t ch·ª•p chung h√¨nh m gh√™ √°',
      'Ng·ªô he, ch·ªâ h·ªçc chung nhau l·ªõp 5, m·∫•y l·ªõp kh√°c to√†n ch∆°i chung l√∫c h·ªçc th√™m kh√¥ng',
      'Nh∆∞ng c√≥ sao ƒë√¢u, v·∫´n vui v·∫Ω, v·∫´n chia s·∫ª b√¨nh th∆∞·ªùng',
      'Th·∫≠t s·ª± t v√¥ c√πng tr√¢n tr·ªçng kho·∫£ng th·ªùi gian ·∫•y :3',
      'Ho√†ng Nh∆∞ trong m·∫Øt ƒê·∫°t Nguy·ªÖn lu√¥n m·∫°nh m·∫Ω, c·ª©ng r·∫Øn, ƒë√¥i khi c≈©ng c√≥ ch√∫t n√≥ng n·∫©y, d·ªÖ x√∫c ƒë·ªông.',
      'Nh∆∞ v·∫´n l√† Nh∆∞, v·∫´n l√† Nh·ªØ, v·∫´n l√† c√¥ ba, d√π c√≥ ƒëi ƒë·∫øn ƒë√¢u, ƒë·∫øn m√¥i tr∆∞·ªùng n√†o ',
      'C√¥ Ba s·∫Ω m√£i l√† t·∫•m g∆∞∆°ng ƒë·ªÉ b√© ƒê·∫£n n√¥i theo, ham h·ªçc h·ªèi, ch·ªãu th∆∞∆°ng ch·ªãu kh√≥ :3',
      'Ki√™n c∆∞·ªùng, xinh ƒë·∫πp, kh·ªèe m·∫°nh v√† th·∫≠t nhi·ªÅu mai m·∫Øn'
    ]

    let shown = false
    let readMessages = new Set()
    let allNotes = []
    let notePositions = []

    // === √ÇM THANH ===
    const audioContext = new (window.AudioContext || window.webkitAudioContext)()
    
    function playOpenSound() {
      const osc = audioContext.createOscillator()
      const gain = audioContext.createGain()
      osc.connect(gain)
      gain.connect(audioContext.destination)
      
      osc.frequency.setValueAtTime(800, audioContext.currentTime)
      osc.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.3)
      gain.gain.setValueAtTime(0.3, audioContext.currentTime)
      gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3)
      
      osc.start(audioContext.currentTime)
      osc.stop(audioContext.currentTime + 0.3)
    }

    function playClickSound() {
      const osc = audioContext.createOscillator()
      const gain = audioContext.createGain()
      osc.connect(gain)
      gain.connect(audioContext.destination)
      
      osc.frequency.setValueAtTime(600, audioContext.currentTime)
      gain.gain.setValueAtTime(0.2, audioContext.currentTime)
      gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1)
      
      osc.start(audioContext.currentTime)
      osc.stop(audioContext.currentTime + 0.1)
    }

    function playFireworkSound() {
      const noise = audioContext.createBufferSource()
      const noiseBuffer = audioContext.createBuffer(1, audioContext.sampleRate * 0.5, audioContext.sampleRate)
      const data = noiseBuffer.getChannelData(0)
      for(let i = 0; i < data.length; i++) {
        data[i] = Math.random() * 2 - 1
      }
      noise.buffer = noiseBuffer
      
      const noiseFilter = audioContext.createBiquadFilter()
      noiseFilter.type = 'bandpass'
      noiseFilter.frequency.value = 300
      
      const noiseGain = audioContext.createGain()
      noiseGain.gain.setValueAtTime(0.3, audioContext.currentTime)
      noiseGain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5)
      
      noise.connect(noiseFilter)
      noiseFilter.connect(noiseGain)
      noiseGain.connect(audioContext.destination)
      
      noise.start(audioContext.currentTime)
      noise.stop(audioContext.currentTime + 0.5)
      
      setTimeout(() => {
        for(let i = 0; i < 5; i++) {
          setTimeout(() => {
            const osc = audioContext.createOscillator()
            const gain = audioContext.createGain()
            osc.connect(gain)
            gain.connect(audioContext.destination)
            
            const freq = 1200 + Math.random() * 800
            osc.frequency.setValueAtTime(freq, audioContext.currentTime)
            gain.gain.setValueAtTime(0.15, audioContext.currentTime)
            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2)
            
            osc.start(audioContext.currentTime)
            osc.stop(audioContext.currentTime + 0.2)
          }, i * 100)
        }
      }, 200)
    }

    function random(min, max){return Math.random()*(max-min)+min}

    function isOverlapping(x1, y1, w1, h1, x2, y2, w2, h2, padding = 20) {
      return !(x1 + w1 + padding < x2 || 
               x2 + w2 + padding < x1 || 
               y1 + h1 + padding < y2 || 
               y2 + h2 + padding < y1)
    }

    function findNonOverlappingPosition(wrapWidth, wrapHeight, noteWidth, noteHeight, maxAttempts = 50) {
      for(let attempt = 0; attempt < maxAttempts; attempt++) {
        const x = random(0, Math.max(0, wrapWidth - noteWidth))
        const y = random(0, Math.max(0, wrapHeight - noteHeight))
        
        let overlap = false
        for(let pos of notePositions) {
          if(isOverlapping(x, y, noteWidth, noteHeight, pos.x, pos.y, pos.w, pos.h)) {
            overlap = true
            break
          }
        }
        
        if(!overlap) {
          return { x, y }
        }
      }
      
      return {
        x: random(0, Math.max(0, wrapWidth - noteWidth)),
        y: random(0, Math.max(0, wrapHeight - noteHeight))
      }
    }

    function createFirework(x, y) {
      const colors = ['#ff6b81', '#ffd93d', '#6bcf7f', '#4d96ff', '#ff85a2']
      const particles = 30
      
      for(let i = 0; i < particles; i++) {
        const firework = document.createElement('div')
        firework.className = 'firework'
        firework.style.left = x + 'px'
        firework.style.top = y + 'px'
        firework.style.background = colors[Math.floor(Math.random() * colors.length)]
        
        const angle = (Math.PI * 2 * i) / particles
        const velocity = random(50, 150)
        const tx = Math.cos(angle) * velocity
        const ty = Math.sin(angle) * velocity
        
        firework.style.setProperty('--tx', tx + 'px')
        firework.style.setProperty('--ty', ty + 'px')
        firework.style.animation = 'fireworkExplode 1s ease-out forwards'
        
        document.body.appendChild(firework)
        setTimeout(() => firework.remove(), 1000)
      }
    }

    function launchFireworks() {
      playFireworkSound()
      
      const count = 50
      for(let i = 0; i < count; i++) {
        setTimeout(() => {
          const x = random(window.innerWidth * 0.2, window.innerWidth * 0.8)
          const y = random(window.innerHeight * 0.2, window.innerHeight * 0.6)
          createFirework(x, y)
          
          if(i > 0) playFireworkSound()
        }, i * 300)
      }
    }

    function showNotes(){
      if(shown) return
      shown = true
      
      playOpenSound()
      notePositions = []
      
      card.style.transform = 'scale(.96) translateY(-10px)'
      card.style.opacity = '0.28'

      messages.forEach((msg, i)=>{
        const note = document.createElement('div')
        note.className = 'note'
        note.dataset.index = i
        
        const noteWidth = 160
        const noteHeight = 120
        
        const wrapRect = notesWrap.getBoundingClientRect()
        const pos = findNonOverlappingPosition(wrapRect.width, wrapRect.height, noteWidth, noteHeight)
        
        note.style.left = pos.x + 'px'
        note.style.top = pos.y + 'px'
        
        notePositions.push({ x: pos.x, y: pos.y, w: noteWidth, h: noteHeight })
        
        note.style.transform = `rotate(${random(-12,12)}deg)`

        const p = document.createElement('div')
        p.className = 'msg'
        p.textContent = msg
        const f = document.createElement('div')
        f.className = 'from'
        f.textContent = '‚Äî B√© ƒê·∫£n'
        note.appendChild(p)
        note.appendChild(f)

        notesWrap.appendChild(note)
        allNotes.push(note)

        setTimeout(()=>{
          note.classList.add('show')
          if(Math.random()>0.5) note.classList.add('float')
        }, 120 * i)

        note.addEventListener('click', ()=>{
          const msgIndex = parseInt(note.dataset.index)
          
          playClickSound()
          
          modalMsg.textContent = msg
          modalFrom.textContent = '‚Äî B√© ƒê·∫£n'
          modalOverlay.classList.add('active')
          
          if(!readMessages.has(msgIndex)) {
            readMessages.add(msgIndex)
            note.classList.add('read')
            
            if(readMessages.size === messages.length) {
              setTimeout(() => {
                launchFireworks()
              }, 500)
            }
          }
        })
      })

      resetBtn.classList.remove('hidden')
    }

    function resetAll(){
      notesWrap.innerHTML = ''
      shown = false
      readMessages.clear()
      allNotes = []
      notePositions = []
      card.style.transform = ''
      card.style.opacity = '1'
      resetBtn.classList.add('hidden')
    }

    closeModal.addEventListener('click', () => {
      modalOverlay.classList.remove('active')
    })

    modalOverlay.addEventListener('click', (e) => {
      if(e.target === modalOverlay) {
        modalOverlay.classList.remove('active')
      }
    })

    card.addEventListener('click', showNotes)
    resetBtn.addEventListener('click', resetAll)
  </script>
</body>
</html>